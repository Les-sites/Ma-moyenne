<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Notes Ultra - Essentiel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #0f172a; 
            color: #f1f5f9;
        }

        .glass-card { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 24px;
            transition: transform 0.2s;
        }
        
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 10px; }

        .badge-unlock { animation: bounce 0.5s ease infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }
        
        .consultation-mode .admin-only { display: none !important; }

        input, select {
            background: rgba(15, 23, 42, 0.5) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
        }

        input:focus {
            border-color: #6366f1 !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }
    </style>
</head>
<body class="p-4 md:p-6 min-h-screen custom-scroll">

    <div class="max-w-7xl mx-auto">
        <!-- Barre Sup√©rieure -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-8">
            <div class="lg:col-span-1 flex flex-col justify-center">
                <div class="flex items-center gap-3">
                    <h1 class="text-3xl font-black tracking-tight text-indigo-500">Focus<span class="text-white">Notes</span></h1>
                </div>
                <div class="flex gap-2 mt-3">
                    <select id="trimestre-select" onchange="switchTrimestre()" class="text-xs font-bold px-3 py-1 rounded-full outline-none cursor-pointer">
                        <option value="1">Trimestre 1</option>
                        <option value="2">Trimestre 2</option>
                        <option value="3">Trimestre 3</option>
                    </select>
                </div>
            </div>

            <div class="glass-card p-4 flex items-center justify-between shadow-lg border-b-4 border-indigo-500">
                <div>
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block">Moyenne</span>
                    <div id="moyenne-generale" class="text-3xl font-black text-indigo-400 leading-none">--</div>
                </div>
                <div class="text-right">
                    <span id="status-text" class="text-[10px] font-bold text-slate-400 uppercase">En attente</span>
                    <div id="points-diff" class="text-sm font-bold text-slate-500">Obj: --</div>
                </div>
            </div>

            <div class="glass-card p-4 flex items-center justify-between shadow-lg border-b-4 border-emerald-500">
                <div>
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block">Objectif</span>
                    <input type="number" id="target-input" value="15" step="0.5" oninput="updateTarget()" class="bg-transparent text-3xl font-black text-emerald-500 outline-none w-16 admin-only">
                    <span id="target-view" class="hidden text-3xl font-black text-emerald-500">15</span>
                </div>
                <div class="w-12 h-12 rounded-full border-4 border-slate-700 flex items-center justify-center">
                    <span id="progress-percent" class="text-[10px] font-black">0%</span>
                </div>
            </div>

            <div class="glass-card p-4 flex items-center justify-around shadow-lg bg-gradient-to-br from-indigo-600 to-purple-700 text-white border-none">
                <div class="text-center">
                    <span class="text-[10px] font-bold uppercase opacity-80">Focus Timer</span>
                    <div id="timer-display" class="text-2xl font-black">25:00</div>
                </div>
                <button onclick="toggleTimer()" id="timer-btn" class="bg-white/20 hover:bg-white/30 p-2 rounded-full transition-all text-xl">
                    ‚ñ∂Ô∏è
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- COLONNE GAUCHE: Saisie & Liste -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Ajouter une Note -->
                <div class="glass-card p-6 shadow-xl admin-only">
                    <h3 class="text-sm font-black mb-4 flex items-center gap-2">‚úçÔ∏è AJOUTER UNE NOTE</h3>
                    <div class="space-y-3">
                        <input type="text" id="nom-matiere" placeholder="Mati√®re (Maths, Anglais...)" class="w-full p-3 rounded-xl">
                        <div class="grid grid-cols-2 gap-3">
                            <input type="number" id="moy-matiere" placeholder="Note /20" class="p-3 rounded-xl">
                            <input type="number" id="coeff-matiere" placeholder="Coeff" value="1" class="p-3 rounded-xl">
                        </div>
                        <button id="btn-add" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl hover:scale-[1.02] transition-transform shadow-lg shadow-indigo-900/20">Enregistrer</button>
                    </div>
                </div>

                <!-- Liste des Notes -->
                <div class="space-y-3">
                    <div class="flex justify-between items-center px-2">
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest">Mes Notes</h3>
                        <span id="note-count" class="text-[10px] bg-slate-700 px-2 py-0.5 rounded-full">0</span>
                    </div>
                    <div id="liste-matieres" class="space-y-3 max-h-[500px] overflow-y-auto pr-2 custom-scroll">
                        <!-- Items dynamiques -->
                    </div>
                </div>
            </div>

            <!-- COLONNE CENTRALE: Graphique -->
            <div class="lg:col-span-5 space-y-6">
                <div class="glass-card p-6 shadow-xl h-[500px] flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold">Analyse de Performance</h3>
                        <div class="flex gap-1" id="trophy-room">
                            <!-- Badges -->
                        </div>
                    </div>
                    <div class="flex-1">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- COLONNE DROITE: Agenda & T√¢ches -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Agenda -->
                <div class="glass-card p-5 shadow-xl">
                    <h3 class="text-xs font-black mb-4 tracking-widest uppercase text-slate-400">üìÖ Agenda Examens</h3>
                    <div class="space-y-3 mb-4 max-h-[180px] overflow-y-auto custom-scroll" id="exam-list">
                        <!-- Examens -->
                    </div>
                    <div class="space-y-2 admin-only border-t border-slate-700 pt-3">
                        <input type="text" id="exam-name" placeholder="Sujet du DS" class="w-full p-2 text-xs rounded-lg">
                        <input type="date" id="exam-date" class="w-full p-2 text-xs rounded-lg">
                        <button onclick="addExam()" class="w-full bg-slate-700 py-2 rounded-lg text-xs font-bold hover:bg-indigo-600 transition-all">Ajouter</button>
                    </div>
                </div>

                <!-- To-Do List -->
                <div class="glass-card p-5 shadow-xl">
                    <h3 class="text-xs font-black mb-4 tracking-widest uppercase text-slate-400">‚úÖ √Ä R√©viser</h3>
                    <div class="space-y-2 max-h-[180px] overflow-y-auto custom-scroll" id="todo-list">
                        <!-- Todo -->
                    </div>
                    <div class="mt-3 flex gap-2 admin-only border-t border-slate-700 pt-3">
                        <input type="text" id="todo-input" placeholder="Chapitre..." class="flex-1 p-2 text-xs rounded-lg">
                        <button onclick="addTodo()" class="bg-indigo-600 text-white px-3 rounded-lg text-sm font-bold">+</button>
                    </div>
                </div>

                <!-- Partage -->
                <div class="glass-card p-5 shadow-xl admin-only">
                    <h3 class="text-xs font-black mb-3 tracking-widest uppercase text-slate-400">üì§ Partage</h3>
                    <button onclick="generateShareQR()" class="w-full bg-slate-800 border border-slate-700 text-slate-300 p-3 rounded-xl text-[10px] font-black hover:bg-indigo-600 hover:text-white transition-all">
                        QR CODE D'ACC√àS
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Modal -->
    <div id="qr-modal" class="fixed inset-0 bg-black/90 hidden flex items-center justify-center p-4 z-50 backdrop-blur-md">
        <div class="bg-slate-900 border border-slate-700 p-8 rounded-[32px] text-center max-w-sm w-full shadow-2xl">
            <h3 class="text-xl font-bold mb-2">Acc√®s Parent</h3>
            <p class="text-slate-500 text-xs mb-6">Scanner ce code pour consulter les notes sur un autre appareil.</p>
            <div id="qrcode" class="mb-6 flex justify-center p-4 bg-white rounded-2xl"></div>
            <button onclick="document.getElementById('qr-modal').classList.add('hidden')" class="w-full bg-slate-800 py-3 rounded-xl font-bold hover:bg-slate-700 transition-colors">Fermer</button>
        </div>
    </div>

    <script>
        let currentTrimestre = "1";
        let dataStore = JSON.parse(localStorage.getItem('focus_notes_ultra_clean')) || {
            "1": { matieres: [], target: 15, exams: [], todos: [] },
            "2": { matieres: [], target: 15, exams: [], todos: [] },
            "3": { matieres: [], target: 15, exams: [], todos: [] }
        };
        
        let chart = null;
        let timerSeconds = 1500;
        let timerActive = false;
        let timerInterval = null;

        function save() {
            localStorage.setItem('focus_notes_ultra_clean', JSON.stringify(dataStore));
            calculateAll();
            render();
        }

        function switchTrimestre() {
            currentTrimestre = document.getElementById('trimestre-select').value;
            render();
        }

        function updateTarget() {
            dataStore[currentTrimestre].target = parseFloat(document.getElementById('target-input').value) || 10;
            save();
        }

        function calculateAll() {
            const current = dataStore[currentTrimestre];
            let total = 0, coeffs = 0;
            current.matieres.forEach(m => { total += (m.note * m.coeff); coeffs += m.coeff; });
            
            const moy = coeffs > 0 ? (total / coeffs).toFixed(2) : "--";
            document.getElementById('moyenne-generale').textContent = moy;
            document.getElementById('note-count').textContent = current.matieres.length;

            if(moy !== "--") {
                const diff = (parseFloat(moy) - current.target).toFixed(1);
                const status = document.getElementById('status-text');
                const diffEl = document.getElementById('points-diff');
                
                if(diff >= 0) {
                    status.textContent = "Objectif Atteint";
                    status.className = "text-[10px] font-bold text-emerald-500 uppercase";
                    diffEl.textContent = `+${diff} pts d'avance`;
                } else {
                    status.textContent = "En progression";
                    status.className = "text-[10px] font-bold text-rose-500 uppercase";
                    diffEl.textContent = `${Math.abs(diff)} pts manquants`;
                }
                
                const percent = Math.min(100, Math.max(0, (parseFloat(moy) / current.target) * 100)).toFixed(0);
                document.getElementById('progress-percent').textContent = percent + "%";
            }

            if(chart) {
                chart.data.labels = current.matieres.map(m => m.nom);
                chart.data.datasets[0].data = current.matieres.map(m => m.note);
                chart.update();
            }

            updateTrophies(moy);
        }

        function updateTrophies(moy) {
            const container = document.getElementById('trophy-room');
            container.innerHTML = '';
            const m = parseFloat(moy);
            if(m >= 10) container.innerHTML += '<span title="La Moyenne !" class="badge-unlock text-xl">ü•â</span>';
            if(m >= 14) container.innerHTML += '<span title="Mention Bien" class="badge-unlock text-xl">ü•à</span>';
            if(m >= 16) container.innerHTML += '<span title="Excellent" class="badge-unlock text-xl">ü•á</span>';
        }

        function render() {
            const current = dataStore[currentTrimestre];
            
            const list = document.getElementById('liste-matieres');
            list.innerHTML = '';
            current.matieres.forEach((m, i) => {
                const el = document.createElement('div');
                el.className = "glass-card p-4 flex justify-between items-center border-l-4 " + (m.note >= 10 ? 'border-l-indigo-500' : 'border-l-rose-500');
                el.innerHTML = `
                    <div class="flex-1">
                        <div class="font-bold text-sm">${m.nom}</div>
                        <div class="text-[9px] font-black text-slate-500 uppercase tracking-tighter">Coeff ${m.coeff}</div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <span class="text-lg font-black ${m.note >= 10 ? 'text-indigo-400' : 'text-rose-400'}">${m.note}</span>
                        </div>
                        <button onclick="deleteNote(${i})" class="text-slate-600 hover:text-rose-500 admin-only">‚úï</button>
                    </div>
                `;
                list.appendChild(el);
            });

            const exList = document.getElementById('exam-list');
            exList.innerHTML = '';
            current.exams.forEach((ex) => {
                const days = Math.ceil((new Date(ex.date) - new Date()) / (1000 * 60 * 60 * 24));
                const el = document.createElement('div');
                el.className = `p-2 rounded-lg border-l-4 text-xs flex justify-between items-center bg-slate-800/50 ${days < 3 ? 'border-rose-500' : 'border-indigo-400'}`;
                el.innerHTML = `
                    <div><div class="font-bold">${ex.name}</div><div class="opacity-50 text-[9px]">${ex.date}</div></div>
                    <div class="font-black text-[10px]">${days < 0 ? 'Fini' : 'J-'+days}</div>
                `;
                exList.appendChild(el);
            });

            const todoList = document.getElementById('todo-list');
            todoList.innerHTML = '';
            current.todos.forEach((t, i) => {
                const el = document.createElement('div');
                el.className = "flex items-center gap-2 text-xs p-1";
                el.innerHTML = `
                    <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTodo(${i})" class="rounded bg-slate-800 border-slate-700">
                    <span class="${t.done ? 'line-through opacity-40' : ''}">${t.text}</span>
                `;
                todoList.appendChild(el);
            });

            calculateAll();
        }

        document.getElementById('btn-add').onclick = () => {
            const nom = document.getElementById('nom-matiere').value.trim();
            const note = parseFloat(document.getElementById('moy-matiere').value);
            const coeff = parseFloat(document.getElementById('coeff-matiere').value) || 1;
            if(nom && !isNaN(note)) {
                dataStore[currentTrimestre].matieres.push({ nom, note, coeff });
                document.getElementById('nom-matiere').value = '';
                document.getElementById('moy-matiere').value = '';
                save();
            }
        };

        function deleteNote(i) { dataStore[currentTrimestre].matieres.splice(i, 1); save(); }
        function addExam() {
            const name = document.getElementById('exam-name').value;
            const date = document.getElementById('exam-date').value;
            if(name && date) { dataStore[currentTrimestre].exams.push({ name, date }); save(); }
        }
        function addTodo() {
            const text = document.getElementById('todo-input').value;
            if(text) { dataStore[currentTrimestre].todos.push({ text, done: false }); save(); }
        }
        function toggleTodo(i) { dataStore[currentTrimestre].todos[i].done = !dataStore[currentTrimestre].todos[i].done; save(); }

        function toggleTimer() {
            if(timerActive) {
                clearInterval(timerInterval);
                document.getElementById('timer-btn').textContent = '‚ñ∂Ô∏è';
            } else {
                timerInterval = setInterval(() => {
                    timerSeconds--;
                    updateTimerDisplay();
                    if(timerSeconds <= 0) { clearInterval(timerInterval); alert("Session termin√©e !"); timerSeconds = 1500; }
                }, 1000);
                document.getElementById('timer-btn').textContent = '‚è∏Ô∏è';
            }
            timerActive = !timerActive;
        }

        function updateTimerDisplay() {
            const mins = Math.floor(timerSeconds / 60);
            const secs = timerSeconds % 60;
            document.getElementById('timer-display').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function generateShareQR() {
            const params = btoa(JSON.stringify({
                m: dataStore[currentTrimestre].matieres,
                t: dataStore[currentTrimestre].target,
                viewOnly: true
            }));
            const url = window.location.origin + window.location.pathname + "?data=" + params;
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById('qrcode'), { text: url, width: 180, height: 180 });
            document.getElementById('qr-modal').classList.remove('hidden');
        }

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if(params.has('data')) {
                const decoded = JSON.parse(atob(params.get('data')));
                dataStore[currentTrimestre].matieres = decoded.m;
                dataStore[currentTrimestre].target = decoded.t;
                document.body.classList.add('consultation-mode');
                document.getElementById('target-view').classList.remove('hidden');
                document.getElementById('target-input').classList.add('hidden');
            }

            const ctx = document.getElementById('performanceChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: { labels: [], datasets: [{ label: 'Notes', data: [], backgroundColor: 'rgba(99, 102, 241, 0.4)', borderColor: '#6366f1', borderWidth: 2, borderRadius: 8 }] },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { 
                        y: { beginAtZero: true, max: 20, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                        x: { grid: { display: false }, ticks: { color: '#64748b' } }
                    },
                    plugins: { legend: { display: false } } 
                }
            });

            render();
        };
    </script>
</body>
</html>
 



